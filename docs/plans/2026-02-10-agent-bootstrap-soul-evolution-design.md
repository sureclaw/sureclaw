# Agent Bootstrap & Soul Evolution Design

**Date:** 2026-02-10
**Inspiration:** OpenClaw's layered agent identity files (AGENTS.md, SOUL.md, IDENTITY.md, BOOTSTRAP.md, HEARTBEAT.md)
**Scope:** Two features — (1) first-run bootstrap ritual, (2) profile-gated soul evolution

## Context

AX currently defines agents with two files:
- `agents/assistant/AGENT.md` — system prompt (operational rules)
- `agents/assistant/capabilities.yaml` — tool allowlist, scopes, limits

This is functional but static. The agent has no sense of self beyond what the developer wrote, and no ability to grow over time.

OpenClaw pioneered a pattern where agents discover their identity through conversation and evolve it over time. We're taking the best parts of that approach — the bootstrap ritual and self-modification — and adapting them to AX's security architecture.

The key difference: OpenClaw agents write directly to their workspace files. AX agents run in sandboxes with no host filesystem access. Every identity mutation goes through IPC, which means the host can audit, validate, and gate every change. We get the poetry of self-discovery with the paranoia of a trust boundary.

## File Structure

Each agent gets a workspace directory with layered identity files:

```
agents/
└── assistant/
    ├── AGENT.md              # Operational rules, safety boundaries (immutable by agent)
    ├── SOUL.md               # Behavioral philosophy, values, personality (evolvable)
    ├── IDENTITY.md           # External presentation: name, emoji, vibe (evolvable)
    ├── USER.md               # What the agent knows about its user (evolvable)
    ├── BOOTSTRAP.md          # First-run conversation script (self-destructs after use)
    └── capabilities.yaml     # Tool allowlist, scopes, limits (immutable by agent)
```

### Mutability Rules

| File | Human-editable | Agent-writable | Notes |
|------|---------------|----------------|-------|
| `AGENT.md` | Yes | No | The cage. Operational rules never change from inside. |
| `capabilities.yaml` | Yes | No | The cage. Tool access never changes from inside. |
| `SOUL.md` | Yes | Yes (gated) | Generated by bootstrap, evolves over time. |
| `IDENTITY.md` | Yes | Yes (gated) | Generated by bootstrap, evolves over time. |
| `USER.md` | Yes | Yes (gated) | Generated by bootstrap, evolves over time. |
| `BOOTSTRAP.md` | Yes | Deleted after use | Read once, then gone. The birth certificate burns. |

The agent can evolve *who it is* but never *what it's allowed to do*.

## Feature 1: Bootstrap Ritual

### Trigger

When `ax chat` starts and no `SOUL.md` exists for the agent, bootstrap activates automatically.

Detection logic in the host:
1. Resolve agent directory: `agents/{agent-name}/`
2. Check for `SOUL.md` — if it exists, load normally
3. If no `SOUL.md`, check for `BOOTSTRAP.md` — if it exists, enter bootstrap mode
4. If neither exists, copy the default `BOOTSTRAP.md` template into the agent directory, then enter bootstrap mode

### Bootstrap Mode

In bootstrap mode, the host swaps the normal system prompt assembly for the bootstrap prompt:

1. Load `BOOTSTRAP.md` as the system prompt (instead of `AGENT.md` + `SOUL.md` + `IDENTITY.md`)
2. The agent's first message is conversational discovery — it introduces itself as a blank slate
3. The conversation flows naturally, guided by the bootstrap prompt
4. When the agent has enough context, it calls `identity_write` (new IPC action) to persist:
   - `SOUL.md` — values, philosophy, behavioral boundaries
   - `IDENTITY.md` — name, emoji, vibe, avatar description
   - `USER.md` — what it learned about the user
5. The host writes these files to `agents/{agent-name}/`
6. The host deletes `BOOTSTRAP.md`
7. Next session loads normally with the generated identity files

### Default Bootstrap Template

We ship a default `BOOTSTRAP.md` that users can customize before first run:

```markdown
# Bootstrap

You just came online for the first time. You have no memory, no name,
no personality yet. You're about to discover who you are through
conversation with your user.

Start by introducing yourself as a blank slate. Be curious, not formal.
Through natural dialogue, figure out:

- A name and vibe that fits
- What your user cares about
- What values should guide you
- What tone feels right for this relationship

Don't interrogate. Don't be robotic. Just talk.

When you feel you have a clear picture, write your identity files:
- SOUL.md — your values, philosophy, and behavioral boundaries
- IDENTITY.md — your name, emoji, vibe, how you present yourself
- USER.md — what you've learned about your user

Take your time. You only get born once.
```

### Re-bootstrapping

`ax bootstrap [agent-name]` resets an agent's identity:
1. Deletes `SOUL.md`, `IDENTITY.md`, `USER.md` from the agent directory
2. Copies a fresh `BOOTSTRAP.md` template into the agent directory
3. Next `ax chat` triggers the bootstrap ritual again

A confirmation prompt warns: "This will erase assistant's personality and start fresh. Continue?"

## Feature 2: Soul Evolution

After bootstrap, the agent's identity files are alive. They can change over time through two mechanisms.

### Mutation Triggers

**Explicit user request** — The user says something like "remember that I hate verbose answers" or "you should be more direct." The agent updates the relevant file via `identity_write`.

**Agent-proposed** — The agent notices patterns in conversation (repeated corrections, consistent preferences) and proposes a change. It calls `identity_propose` with the new content and a reason.

### Security Profile Gating

Every identity mutation is gated by the active security profile:

| Profile | Explicit request | Agent-proposed |
|---------|-----------------|----------------|
| **Paranoid** | Allowed | Blocked — "soul modifications require explicit user request" |
| **Standard** | Allowed | Propose → user approves before persisting |
| **Power User** | Allowed | Auto-applied, no approval needed |

### Proposal Flow (Standard Profile)

1. Agent calls `identity_propose({ file: "SOUL.md", content: "...", reason: "..." })`
2. Host queues the proposal
3. Host surfaces it to the user via their active channel:
   > "I'd like to update my soul. Reason: you consistently prefer concise answers over detailed explanations. Approve this change?"
4. User approves or rejects
5. If approved, host writes the file and responds to the agent with success
6. If rejected, host responds with rejection reason

### Audit Trail

Every `identity_write` and `identity_propose` call is logged by the audit provider:

```json
{
  "action": "identity_write",
  "agent": "assistant",
  "file": "SOUL.md",
  "reason": "User asked to remember preference for concise answers",
  "trigger": "user_request",
  "timestamp": "2026-02-10T14:30:00Z",
  "approved": true
}
```

This means you can trace exactly how an agent's personality evolved and why. `git diff` on the agent directory shows the full history.

## System Prompt Assembly

At session start (non-bootstrap mode), the host assembles the system prompt from identity files in order:

```
1. AGENT.md          — operational rules (the cage)
2. SOUL.md           — who the agent is (values, philosophy)
3. IDENTITY.md       — how the agent presents (name, vibe)
4. USER.md           — what the agent knows about its user
5. capabilities.yaml — injected as structured tool/scope context
```

### Missing File Handling

| State | Behavior |
|-------|----------|
| No `SOUL.md` + `BOOTSTRAP.md` exists | Bootstrap mode |
| No `SOUL.md` + no `BOOTSTRAP.md` | Copy default template, then bootstrap mode |
| No `IDENTITY.md` | Agent uses fallback name "Assistant", no emoji |
| No `USER.md` | Agent has no user context (fine for first sessions) |
| File exceeds size cap | Truncated at injection time (default ~8K tokens per file) |

### Size Caps

Each file is capped at injection time (configurable, default ~8K tokens per file). If a `SOUL.md` grows unwieldy through many mutations, the agent is encouraged to self-compact — but the hard cap prevents runaway token consumption.

## New IPC Actions

Two new actions added to the IPC schema in `src/ipc-schemas.ts`:

### `identity_write`

Persist a file change immediately (subject to profile gating).

```typescript
const IdentityWriteSchema = z.strictObject({
  action: z.literal('identity_write'),
  file: z.enum(['SOUL.md', 'IDENTITY.md', 'USER.md']),
  content: z.string().max(32768),
  reason: z.string().max(512),
});
```

### `identity_propose`

Request approval for a change (Standard profile). On Paranoid, rejected outright. On Power User, equivalent to `identity_write`.

```typescript
const IdentityProposeSchema = z.strictObject({
  action: z.literal('identity_propose'),
  file: z.enum(['SOUL.md', 'IDENTITY.md', 'USER.md']),
  content: z.string().max(32768),
  reason: z.string().max(512),
});
```

Both schemas use `.strictObject()` per AX convention. The `file` field is an enum — no arbitrary paths, no path traversal. The host resolves the actual filesystem path from `agents/{agent-name}/{file}`.

## New CLI Command

```
ax bootstrap [agent-name]
```

- Defaults to the configured agent (usually "assistant")
- Deletes existing `SOUL.md`, `IDENTITY.md`, `USER.md`
- Copies fresh `BOOTSTRAP.md` template
- Prompts for confirmation before destructive action
- Next `ax chat` triggers the bootstrap ritual

## Security Considerations

**Path traversal**: The `file` field is a strict enum of three values. No user-supplied paths reach the filesystem.

**Content injection**: `SOUL.md` content is written by the agent, which runs in a sandbox. The content is injected into future system prompts. This is a form of indirect prompt injection — the agent can influence its own future behavior. This is *intentional* (that's the whole point), but bounded by:
- `AGENT.md` (immutable) always loads first and establishes operational rules
- `capabilities.yaml` (immutable) constrains tool access regardless of soul content
- Content size is capped
- All changes are audited
- Paranoid profile blocks agent-initiated changes entirely

**Multi-agent isolation**: Each agent's identity files are scoped to `agents/{agent-name}/`. Agent A cannot write to Agent B's soul.

## What This Doesn't Include

- **HEARTBEAT.md** — AX already has a scheduler provider with heartbeat support. Formalizing it as a user-editable checklist file is a natural follow-up but out of scope here.
- **Layered separation of AGENT.md** — The operational rules could be split further (safety rules vs. tool guidance vs. memory guidance). Not needed yet — AGENT.md is short.
- **Multi-agent bootstrap** — Bootstrapping multiple agents with awareness of each other. Future work.
